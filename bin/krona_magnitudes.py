#!/usr/bin/env python3
"""Add magnitude information to the Krona chart.

Usage:
  krona_magnitudes.py <input_taxtab> <input_stats> <output>

<input_taxtab> is the file generated by `ktClassifyBLAST`.
<input_stat> is the file generated by `BBtools pileup.sh` script.
<output> is output taxMagtab; `ktImportTaxonomy` will use this to generate
a Krona chart where the size of the pie-parts are scaled to the number of 
aligned reads.

Example:
  krona_magnitudes.py data/taxonomic_classification/[sample_name].taxtab data/scaffolds_filtered/[sample_name]_perMinLenFiltScaffold.stats data/taxonomic_classification/[sample_name].taxMagtab
"""

import pandas as pd
from sys import argv

SCRIPT, INPUTTAX, INPUTSTATS, OUTPUTFILE = argv

df_tax = pd.read_csv(INPUTTAX, sep = '\t')

fields = ['#ID', 'Plus_reads', 'Minus_reads']
df_stats = pd.read_csv(INPUTSTATS, sep = '\t', usecols=fields)

df_stats["Nr_of_reads"] = df_stats["Plus_reads"].add(df_stats["Minus_reads"])
df_stats.drop(['Plus_reads', 'Minus_reads'], axis=1, inplace=True)

merged_tax_readCount = pd.merge(df_tax, df_stats, how = "left", left_on = "#queryID", right_on = "#ID").drop('#ID', axis=1)

merged_tax_readCount.to_csv(OUTPUTFILE, index = False, sep = "\t")
